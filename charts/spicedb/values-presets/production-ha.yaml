# High Availability: designed to layer with production presets for maximum availability
# Usage: helm install NAME . -f values-presets/production-postgres.yaml -f values-presets/production-ha.yaml --set config.existingSecret=SECRET
# Prerequisites: Multi-zone Kubernetes cluster (3+ zones recommended), Metrics Server for HPA

replicaCount: 5

autoscaling:
  enabled: true
  minReplicas: 5
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

podDisruptionBudget:
  enabled: true
  maxUnavailable: 2

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          topologyKey: topology.kubernetes.io/zone
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: spicedb

topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: spicedb
